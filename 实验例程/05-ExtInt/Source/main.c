/*********************************************************************************************
* 文件：main.c
* 作者：Meixin 2017.09.15
* 说明：外部中断实验 例程    
*       使用外部中断，当按键按下通信灯、组网灯反转
* 修改：
* 注释：
*********************************************************************************************/

/*********************************************************************************************
* 头文件
*********************************************************************************************/
#include <ioCC2530.h>
#include "delay.h"
#include "led.h"
#include "key.h"
#include "extint.h"

/*********************************************************************************************
* 名称：main()
* 功能：实验逻辑代码
* 参数：无
* 返回：无
* 修改：
* 注释：
*********************************************************************************************/
void main(void)
{
  xtal_init();                                                  //系统时钟初始化
  led_init();                                                   //LED控制端口初始化;
  ext_init();                                                   //外部中断初始化   
  D2 = ON;                                                      //打开D2 
  while(1);
}

/*********************************************************************************************
* 名称：中断服务子程序
* 功能：外部中断
* 参数：无
* 返回：无
* 修改：
* 注释：
*********************************************************************************************/
#pragma vector = P1INT_VECTOR
__interrupt void P1_ISR(void)
{
  EA = 0;                                                       //关中断  
  if((P1IFG & 0x04 ) >0 )                                       //按键中断
  {    
    P1IFG &= ~0x04;                                             //中断标志清0
    delay_ms(10);                                               //按键防抖
    if(K1 == DOWN)                                              //判断按键按下
    {  
      D1 = !D1;                                                 //翻转LED0
      D2 = !D2;                                                 //翻转LED1
    }
  }
  EA = 1;                                                       //开中断
}