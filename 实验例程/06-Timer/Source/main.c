/*********************************************************************************************
* 文件：main.c
* 作者：Meixin 2017.09.20
* 说明：定时器实验 例程    
*       通过定时器实现通信灯（定时器）、组网灯（延时函数）一秒闪烁（两种方式实现）
* 修改：
* 注释：
*********************************************************************************************/

/*********************************************************************************************
* 头文件
*********************************************************************************************/
#include <ioCC2530.h>
#include "delay.h"
#include "led.h"
#include "timer.h"

/*********************************************************************************************
* 定义
*********************************************************************************************/
u32 counter = 0;                                                //统计溢出次数

/*********************************************************************************************
* 名称：main()
* 功能：LED驱动实验逻辑代码
* 参数：无
* 返回：无
* 修改：
* 注释：
*********************************************************************************************/
void main(void)
{
  xtal_init();                                                  //CC2530时钟初始化
  led_init();                                                   //LED灯管脚初始化
  time1_init();                                                 //定时器1初始化
  
  while(1)
  {
    delay_s(1);                                                 //软件延时1s
    D2 = !D2;                                                   //改变D2的状态
  }
}

/*********************************************************************************************
* 名称：
* 功能：中断服务子程序
* 参数：无
* 返回：无
* 修改：
* 注释：
*********************************************************************************************/
#pragma vector = T1_VECTOR      
__interrupt void T1_ISR(void)            
{       
  EA=0;                                                         //关总中断
  counter++;                                                    //统计进入中断的次数
  if(counter>100)                                               //初始化中定义10ms进一次中断，经过100次中断，10ms × 100 = 1S
  {
    counter=0;                                                  //统计的次数复位
    D1 = !D1;                                                   //改变D1的状态
  }
  T1IF=0;                                                       //中断标志位清零
  EA=1;                                                         //开总中断
}